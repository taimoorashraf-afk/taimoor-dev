<div class="solutions-video-carousels" id="solutions-vid-carousel">
    <div class="page-width">
        <div class="row">
            <div class="carousel-left-col">
                <div class="solution-vid-carousel">
                    <div class="carousel-container">
                        {% for block in section.blocks %}
                            <div class="carousel-vid-item{% if forloop.first %} active{% endif %}" {{ block.shopify_attributes }}>
                                {% if block.settings.carousel_video %}
                                    <iframe width="100%" height="560px" src="http://fast.wistia.com/embed/iframe/{{ block.settings.carousel_video }}?version=v1&controlsVisibleOnLoad=true&playerColor=efebe6" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                    
                    <div class="carousel-navigation">
                        <div class="pagination">
                            <span class="current font-neue-roman">1</span>/<span class="total">{{ section.blocks.size }}</span>
                        </div>
                        <div class="dots">
                            {% for block in section.blocks %}
                                <span class="dot{% if forloop.first %} active{% endif %}" data-index="{{ forloop.index0 }}"></span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="carousel-right-col">
                <div class="content-box">
                    <h2 class="font-neue-light">{{ section.settings.video_first_heading }}</h2>
                    <p class="font-neue-roman">{{ section.settings.video_first_content }}</p>
                    {% if section.settings.video_learnmore_text != blank %}
                      <a class="font-neue-roman" href="{{ section.settings.video_learnmore_url }}">{{ section.settings.video_learnmore_text }}
                          <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.04 11.49">
                              <defs>
                                  <style>.cls-1{stroke-miterlimit:5;}.cls-1,.cls-2{fill:none;stroke:#000;stroke-width:1.5px;}.cls-2{stroke-linejoin:round;}</style>
                              </defs>
                              <g id="Layer_2-2">
                                  <polyline class="cls-1" points="12.45 .54 17.95 5.74 12.45 10.94"></polyline>
                                  <line class="cls-2" y1="5.74" x2="17.95" y2="5.74"></line>
                              </g>
                          </svg>
                      </a>
                    {% endif %}
                </div>

                <div class="content-box">
                    <h2 class="font-neue-light">{{ section.settings.video_second_heading }}</h2>
                    <p class="font-neue-roman">{{ section.settings.video_second_content }}</p>
                    {% if section.settings.video_bottom_learnmore_text != blank %}
                      <a class="font-neue-roman" href="{{ section.settings.video_bottom_learnmore_url }}">{{ section.settings.video_bottom_learnmore_text }}
                          <svg id="Layer_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.04 11.49">
                              <defs>
                                  <style>.cls-1{stroke-miterlimit:5;}.cls-1,.cls-2{fill:none;stroke:#000;stroke-width:1.5px;}.cls-2{stroke-linejoin:round;}</style>
                              </defs>
                              <g id="Layer_2-2">
                                  <polyline class="cls-1" points="12.45 .54 17.95 5.74 12.45 10.94"></polyline>
                                  <line class="cls-2" y1="5.74" x2="17.95" y2="5.74"></line>
                              </g>
                          </svg>
                      </a>  
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>


<style>
    .solutions-video-carousels .row {
        display: flex;
        align-items: center;
        gap: 0 173px;
        min-height: 560px;
    }
    .solutions-video-carousels{
        margin-bottom: 142px !important;
        position: relative;
    }
    .solutions-video-carousels .carousel-left-col {
        width: 711px;
    }
    .solutions-video-carousels .carousel-right-col {
        width: 442px;
        min-width: 442px;
        max-width: 100%;
    }
    .solution-vid-carousel {
        width: 711px;
        max-width: 100%;
        position: absolute;
        left: 0px;
        top: 0px;
    }
    .carousel-vid-item iframe {
        width: 711px;
        max-width: 100%;
        height: 560px;
        border-top-right-radius: 8px;
        border-bottom-right-radius: 8px;
    }
    .content-box:first-child {
        margin-bottom: 70px;
    }
    .content-box h2 {
        font-size: 40px;
        line-height: 42px;
        color: #292521;
        padding-bottom: 16px;
        border-bottom: 1.5px solid #292521;
        margin-bottom: 16px;
        margin-top: 0;
    }
    .content-box p {
        font-size: 16px;
        line-height: 26px;
        color: #292521;
        margin: 0px 0px 21px;
    }
    .content-box a {
        display: flex;
        gap: 0px 13px;
        font-size: 16px;
        line-height: 23px;
        color: #292521;
    }
    .content-box a svg{
        width: 18.06px;
        height: auto;
    }

    /*
    ** Carousel
    */
    .carousel-container {
        position: relative;
        overflow: hidden;
    }

    .carousel-vid-item {
        display: none;
        transition: opacity 0.5s ease-in-out;
    }

    .carousel-vid-item.active {
        display: block;
    }

    .solution-vid-carousel .carousel-navigation {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0px 10px;
        padding-left: 37px;
        margin-top: 16px;
    }

    .dots {
        display: flex;
        gap: 10px 38px;
    }

    .dot {
        width: 9px;
        height: 9px;
        border-radius: 100%;
        background: #C2BFBA;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .dot.active {
        background: #292521;
    }

    .pagination {
        color: #292521;
        font-size: 16px;
        line-height: 26px;
    }

    /*
    ** Responsive
    */
    @media (max-width: 991px){
        .solution-vid-carousel {
            position: relative;
        }
        .solutions-video-carousels .row{
            flex-flow: column;
        }
        .solutions-video-carousels .carousel-left-col,
        .solutions-video-carousels .carousel-right-col {
            width: 100%;
            min-width: unset;
        }
        .content-right .carousel-img-item img{
            border-radius: 8px !important;
        }
        .solutions-video-carousels .carousel-left-col {
            margin-top: 0;
        }
        .carousel-vid-item iframe {
            width: 100%;
            height: 377px;
            border-radius: 8px;
        }
        .solutions-video-carousels .carousel-right-col {
            margin-top: 47px;
        }
        .carousel-navigation{
            padding-right: 0;
        }
        .solutions-video-carousels .carousel-navigation{
            padding-left: 0;
        }
        .content-box:first-child{
            margin-bottom: 50px;
        }
        div#solutions-vid-carousel {
            margin-bottom: 101px !important;
        }
    }
</style>
<script src="https://fast.wistia.com/assets/external/E-v1.js" async></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.solution-vid-carousel').forEach((carousel, carouselIndex) => {
        const carouselId = `carousel-${carouselIndex}`;
        carousel.setAttribute('data-carousel-id', carouselId);
        
        let currentSlide = 0;
        const slides = carousel.querySelectorAll('.carousel-vid-item');
        const dots = carousel.querySelectorAll('.dot');
        const currentPage = carousel.querySelector('.current');
        const totalPages = carousel.querySelector('.total');
        const totalSlides = slides.length;
        
        totalPages.textContent = totalSlides;

        // Intersection Observer for autoplay
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const activeSlide = carousel.querySelector('.carousel-vid-item.active');
                    if (activeSlide) {
                        const iframe = activeSlide.querySelector('iframe');
                        if (iframe && !iframe.src.includes('autoPlay=true')) {
                            let currentSrc = iframe.src;
                            iframe.src = currentSrc + '&autoPlay=true';
                        }
                    }
                }
            });
        }, { threshold: 0.5 });

        observer.observe(carousel);

        function updateCarousel() {
            slides.forEach((slide, index) => {
                if (index === currentSlide) {
                    slide.classList.add('active');
                    const iframe = slide.querySelector('iframe');
                    if (iframe) {
                        let baseSrc = iframe.src.split('?')[0];
                        iframe.src = `${baseSrc}?version=v1&controlsVisibleOnLoad=true&playerColor=efebe6&autoPlay=true`;
                    }
                } else {
                    slide.classList.remove('active');
                    const iframe = slide.querySelector('iframe');
                    if (iframe) {
                        let baseSrc = iframe.src.split('?')[0];
                        iframe.src = `${baseSrc}?version=v1&controlsVisibleOnLoad=true&playerColor=efebe6`;
                    }
                }
            });
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
            
            currentPage.textContent = currentSlide + 1;
        }
        
        // Add click handlers to dots
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                currentSlide = index;
                updateCarousel();
            });
        });
        
        // Touch support
        let touchStartX = 0;
        
        carousel.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        carousel.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].screenX;
            const difference = touchStartX - touchEndX;
            
            if (Math.abs(difference) > 50) {
                if (difference > 0) {
                    // Swipe left
                    currentSlide = (currentSlide + 1) % totalSlides;
                } else {
                    // Swipe right
                    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                }
                updateCarousel();
            }
        });
    });
});
</script>

{% schema %}
{
    "name": "Solutions Video Carousels",
    "settings": [
        {
            "type": "text",
            "id": "video_first_heading",
            "label": "First heading"
        },
        {
            "type": "textarea",
            "id": "video_first_content",
            "label": "First content"
        },
        {
            "type": "text",
            "id": "video_learnmore_text",
            "label": "Top learn more text"
        },
        {
            "type": "text",
            "id": "video_learnmore_url",
            "label": "Top learn more URL"
        },
        {
            "type": "text",
            "id": "video_second_heading",
            "label": "Second heading"
        },
        {
            "type": "textarea",
            "id": "video_second_content",
            "label": "Second content"
        },
        {
            "type": "text",
            "id": "video_bottom_learnmore_text",
            "label": "Bottom learn more text"
        },
        {
            "type": "text",
            "id": "video_bottom_learnmore_url",
            "label": "Bottom learn more URL"
        }
    ],
    "blocks": [
        {
            "type": "text_block",
            "name": "Add Videos",
            "limit": 8,
            "settings": [
                {
                    "type": "text",
                    "id": "carousel_video",
                    "label": "Add Video Id"
                }
            ]
        }
    ],
    "presets": [
        {
        "name": "Solutions Video Carousels",
        "category": "Custom"
        }
    ] 
}
{% endschema %}